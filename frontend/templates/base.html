<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <title>{% block title %}Smart Parking{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Bootstrap -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  {% block head %}{% endblock %}
</head>
<body class="bg-light">

  {% set role = session.get('role') %}
  {% if role in ['admin', 'staff'] %}
    {% set brand_url = url_for('admin_home') %}
  {% elif role == 'resident' %}
    {% set brand_url = url_for('resident_dashboard') %}
  {% else %}
    {% set brand_url = url_for('login') %}
  {% endif %}

  <nav class="navbar navbar-dark bg-dark mb-3">
    <div class="container-fluid">
      <a class="navbar-brand" href="{{ brand_url }}">Smart Parking</a>

      <div class="d-flex align-items-center gap-2">
        {% if role in ['admin', 'staff'] %}
          <span class="badge bg-primary">Admin</span>

          <!-- ƒê√É B·ªé N√öT "Trang ch·ªß" THEO Y√äU C·∫¶U -->

          <a href="{{ url_for('admin_residents') }}"
             class="btn btn-sm btn-outline-light">
            Qu·∫£n l√Ω c∆∞ d√¢n
          </a>

          <!-- ƒê·ªîI T√äN "C∆∞ d√¢n" -> "DS c∆∞ d√¢n" -->
          <a href="{{ url_for('admin_residents_list') }}"
             class="btn btn-sm btn-outline-light">
            DS c∆∞ d√¢n
          </a>

          <a href="{{ url_for('admin_guests') }}"
             class="btn btn-sm btn-outline-light">
            Kh√°ch ngo√†i
          </a>

          <a href="{{ url_for('admin_report_page') }}"
             class="btn btn-sm btn-outline-light">
            B√°o c√°o
          </a>

          <a href="{{ url_for('admin_chat') }}"
             class="btn btn-sm btn-outline-light">
            Tr√≤ chuy·ªán
          </a>

        {% elif role == 'resident' %}
          <span class="badge bg-success">C∆∞ d√¢n</span>
          <!-- ƒê√É B·ªé N√öT "Trang c∆∞ d√¢n" THEO Y√äU C·∫¶U -->
          <button
            class="btn btn-sm btn-outline-info"
            type="button"
            id="openResidentChat">
            Tr√≤ chuy·ªán
          </button>
        {% endif %}

        {% if role %}
          <a href="{{ url_for('logout') }}"
             class="btn btn-sm btn-outline-light">
            ƒêƒÉng xu·∫•t
          </a>
        {% endif %}
      </div>
    </div>
  </nav>

  <div class="container mb-4 resident-main">
    {% block content %}{% endblock %}
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  {% block scripts %}{% endblock %}

  <script>
    (function () {
      const openBtn   = document.getElementById('openResidentChat');
      const chatPanel = document.getElementById('residentChatPanel');
      const closeBtn  = document.getElementById('closeResidentChat');
      const main      = document.querySelector('.resident-main');

      function openChat() {
        if (chatPanel) {
          chatPanel.classList.add('show');
          if (main) main.classList.add('with-chat');
        }
      }

      function closeChat() {
        if (chatPanel) {
          chatPanel.classList.remove('show');
          if (main) main.classList.remove('with-chat');
        }
      }

      // n√∫t "Tr√≤ chuy·ªán" c·ªßa c∆∞ d√¢n
      if (openBtn && chatPanel) {
        openBtn.addEventListener('click', openChat);
      }
      if (closeBtn) {
        closeBtn.addEventListener('click', closeChat);
      }

      // üî• T·ª∞ ƒê·ªòNG M·ªû CHAT N·∫æU URL C√ì ?chat=1
      const params = new URLSearchParams(window.location.search);
      if (params.get('chat') === '1') {
        openChat();
      }
    })();
  </script>
</body>
</html>
