{% extends "base.html" %}
{% block title %}Trang ch·ªß qu·∫£n tr·ªã Smart Parking{% endblock %}

{% block head %}
<style>
  .stat-card-link {
    text-decoration: none;
    color: inherit;
  }
  .stat-card {
    border-radius: 14px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.04);
    transition: transform 0.15s ease, box-shadow 0.15s ease;
  }
  .stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.08);
  }
  .stat-value {
    font-size: 2.25rem;
    font-weight: 700;
  }
  .stat-label {
    text-transform: uppercase;
    font-size: 0.8rem;
    letter-spacing: 0.08em;
    color: #6c757d;
  }
</style>
{% endblock %}

{% block content %}
<div class="container-xxl">

  <!-- TI√äU ƒê·ªÄ GI·ªÆA TRANG -->
  <div class="text-center mb-4">
    <h1 class="fw-bold">
      üèôÔ∏è Trang ch·ªß qu·∫£n tr·ªã Smart Parking
    </h1>
  </div>

  <!-- H√ÄNG TH·ªêNG K√ä CH√çNH -->
  <div class="row g-3 mb-4">

    <!-- 1. T·ªîNG S·ªê C∆Ø D√ÇN (click -> DS c∆∞ d√¢n) -->
    <div class="col-md-4">
      <a href="{{ url_for('admin_residents') }}" class="stat-card-link">
        <div class="card stat-card h-100">
          <div class="card-body d-flex align-items-center justify-content-between">
            <div>
              <div class="stat-label">T·ªïng s·ªë c∆∞ d√¢n</div>
              <div class="stat-value text-primary">
                {{ stats.total_residents }}
              </div>
            </div>
            <div class="display-5">üë•</div>
          </div>
        </div>
      </a>
    </div>

    <!-- 2. KH√ÅCH NGO√ÄI H√îM NAY (click -> Kh√°ch ngo√†i) -->
    <div class="col-md-4">
      <a href="{{ url_for('admin_guests') }}" class="stat-card-link">
        <div class="card stat-card h-100">
          <div class="card-body d-flex align-items-center justify-content-between">
            <div>
              <div class="stat-label">Kh√°ch ngo√†i h√¥m nay</div>
              <div class="stat-value text-success">
                {{ stats.total_guests_today }}
              </div>
            </div>
            <div class="display-5">üöó</div>
          </div>
        </div>
      </a>
    </div>

    <!-- 3. XE ƒêANG ·ªû B√ÉI (click -> DS xe ƒëang ·ªü b√£i) -->
    <div class="col-md-4">
      <a href="{{ url_for('admin_active_vehicles') }}" class="stat-card-link">
        <div class="card stat-card h-100">
          <div class="card-body d-flex align-items-center justify-content-between">
            <div>
              <div class="stat-label">Xe ƒëang ·ªü b√£i</div>
              <div class="stat-value text-warning">
                {{ stats.active_vehicles }}
              </div>
            </div>
            <div class="display-5">üÖøÔ∏è</div>
          </div>
        </div>
      </a>
    </div>

  </div>

  <!-- BI·ªÇU ƒê·ªí -->
  <div class="row g-3 mb-4">
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-header fw-semibold">
          üìä Doanh thu 7 ng√†y g·∫ßn nh·∫•t
        </div>
        <div class="card-body">
          <canvas id="revenueChart" height="180"></canvas>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-header fw-semibold">
          üöó L∆∞·ª£t xe ra/v√†o 7 ng√†y g·∫ßn nh·∫•t
        </div>
        <div class="card-body">
          <canvas id="trafficChart" height="180"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- TH√îNG B√ÅO H·ªÜ TH·ªêNG (KH√îNG C√íN C·ªòT GHI CH√ö NHANH) -->
  <div class="card mb-4">
    <div class="card-header fw-semibold">
      üîî Th√¥ng b√°o h·ªá th·ªëng
    </div>
    <div class="card-body">
      {% if notifications %}
        <ul class="list-group list-group-flush">
          {% for n in notifications %}
            <li class="list-group-item">
              <div class="d-flex justify-content-between">
                <div>
                  {% if n.level == 'warning' %}
                    <span class="badge bg-warning text-dark me-2">C·∫£nh b√°o</span>
                  {% elif n.level == 'success' %}
                    <span class="badge bg-success me-2">Th√†nh c√¥ng</span>
                  {% else %}
                    <span class="badge bg-info text-dark me-2">Th√¥ng tin</span>
                  {% endif %}
                  <strong>{{ n.title }}</strong>
                </div>
                <small class="text-muted">{{ n.time }}</small>
              </div>
              <div class="mt-1 text-muted small">
                {{ n.message }}
              </div>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-muted mb-0">Hi·ªán ch∆∞a c√≥ th√¥ng b√°o n√†o.</p>
      {% endif %}
    </div>
  </div>

</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>
  // Data t·ª´ server
  const revenueLabels = {{ revenue_labels | tojson | safe }};
  const revenueValues = {{ revenue_values | tojson | safe }};
  const trafficLabels = {{ traffic_labels | tojson | safe }};
  const trafficIn     = {{ traffic_in | tojson | safe }};
  const trafficOut    = {{ traffic_out | tojson | safe }};

  // Bi·ªÉu ƒë·ªì doanh thu
  const ctxRevenue = document.getElementById('revenueChart');
  if (ctxRevenue) {
    new Chart(ctxRevenue, {
      type: 'line',
      data: {
        labels: revenueLabels,
        datasets: [{
          label: 'Doanh thu (VNƒê)',
          data: revenueValues,
          fill: false,
          tension: 0.3
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: true }
        },
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
  }

  // Bi·ªÉu ƒë·ªì l∆∞·ª£t xe
  const ctxTraffic = document.getElementById('trafficChart');
  if (ctxTraffic) {
    new Chart(ctxTraffic, {
      type: 'line',
      data: {
        labels: trafficLabels,
        datasets: [
          {
            label: 'Xe v√†o',
            data: trafficIn,
            fill: false,
            tension: 0.3
          },
          {
            label: 'Xe ra',
            data: trafficOut,
            fill: false,
            tension: 0.3
          }
        ]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: true }
        },
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
  }
</script>
{% endblock %}
