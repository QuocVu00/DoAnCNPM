{% extends "base.html" %}
{% block title %}Trang ch·ªß qu·∫£n tr·ªã Smart Parking{% endblock %}

{% block head %}
  {{ super() }}
  <style>
  .stat-card {
    border: 1px solid rgba(0,0,0,.08);
    border-radius: 14px;
    transition: all .15s ease-in-out;
  }
  .stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 24px rgba(0,0,0,.08);
  }
  .stat-card-link {
    text-decoration: none;
    color: inherit;
  }
  .stat-label {
    font-size: 0.95rem;
    color: #6c757d;
    margin-bottom: .25rem;
  }
  .stat-value {
    font-size: 2rem;
    font-weight: 700;
    line-height: 1.1;
  }
  .stat-icon {
    font-size: 2.2rem;
    opacity: .9;
  }
  .chart-card .card-header{
    display:flex;
    align-items:center;
    justify-content:space-between;
  }
  .chart-title{
    display:flex;
    align-items:center;
    gap:.5rem;
    font-weight:600;
  }
  </style>
{% endblock %}

{% block content %}
<div class="text-center mb-4">
  <h2 class="fw-bold">
    <span style="font-size:1.25em">üè¢</span>
    Trang ch·ªß qu·∫£n tr·ªã Smart Parking
  </h2>
</div>

<div class="row g-3 mb-4">
  <!-- 1. T·ªîNG S·ªê C∆Ø D√ÇN (click -> DS c∆∞ d√¢n) -->
  <div class="col-md-4">
    <!-- S·ª¨A ·ªû ƒê√ÇY: admin_residents_list -->
    <a href="{{ url_for('admin_residents_list') }}" class="stat-card-link">
      <div class="card stat-card h-100">
        <div class="card-body d-flex align-items-center justify-content-between">
          <div>
            <div class="stat-label">T·ªïng s·ªë c∆∞ d√¢n</div>
            <div class="stat-value text-primary">
              {{ stats.total_residents }}
            </div>
          </div>
          <div class="stat-icon text-primary">üë•</div>
        </div>
      </div>
    </a>
  </div>

  <!-- 2. KH√ÅCH NGO√ÄI H√îM NAY -->
  <div class="col-md-4">
    <a href="{{ url_for('admin_guests') }}" class="stat-card-link">
      <div class="card stat-card h-100">
        <div class="card-body d-flex align-items-center justify-content-between">
          <div>
            <div class="stat-label">Kh√°ch ngo√†i h√¥m nay</div>
            <div class="stat-value text-success">
              {{ stats.total_guests_today }}
            </div>
          </div>
          <div class="stat-icon text-success">üöó</div>
        </div>
      </div>
    </a>
  </div>

  <!-- 3. XE ƒêANG ·ªû B√ÉI -->
  <div class="col-md-4">
    <a href="{{ url_for('admin_active_vehicles') }}" class="stat-card-link">
      <div class="card stat-card h-100">
        <div class="card-body d-flex align-items-center justify-content-between">
          <div>
            <div class="stat-label">Xe ƒëang ·ªü b√£i</div>
            <div class="stat-value text-warning">
              {{ stats.active_vehicles }}
            </div>
          </div>
          <div class="stat-icon text-warning">üÖøÔ∏è</div>
        </div>
      </div>
    </a>
  </div>
</div>

<div class="row g-3">
  <!-- Doanh thu 7 ng√†y -->
  <div class="col-lg-6">
    <div class="card chart-card">
      <div class="card-header">
        <div class="chart-title">üìä Doanh thu 7 ng√†y g·∫ßn nh·∫•t</div>
      </div>
      <div class="card-body">
        <canvas id="revenueChart"></canvas>
      </div>
    </div>
  </div>

  <!-- L∆∞·ª£t xe ra/v√†o 7 ng√†y -->
  <div class="col-lg-6">
    <div class="card chart-card">
      <div class="card-header">
        <div class="chart-title">üöó L∆∞·ª£t xe ra/v√†o 7 ng√†y g·∫ßn nh·∫•t</div>
      </div>
      <div class="card-body">
        <canvas id="trafficChart"></canvas>
      </div>
    </div>
  </div>
</div>

{% if notifications and notifications|length > 0 %}
  <div class="mt-4">
    {% for n in notifications %}
      <div class="alert alert-{{ n.level }} mb-2">
        {{ n.message }}
      </div>
    {% endfor %}
  </div>
{% endif %}
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const revenueLabels = {{ revenue_labels|tojson }};
const revenueValues = {{ revenue_values|tojson }};
const trafficLabels = {{ traffic_labels|tojson }};
const trafficIn = {{ traffic_in|tojson }};
const trafficOut = {{ traffic_out|tojson }};

new Chart(document.getElementById('revenueChart'), {
  type: 'line',
  data: {
    labels: revenueLabels,
    datasets: [{
      label: 'Doanh thu (VNƒê)',
      data: revenueValues,
      tension: 0.35,
      fill: false,
    }]
  },
  options: {
    responsive: true,
    plugins: { legend: { display: true } },
    scales: {
      y: { beginAtZero: true }
    }
  }
});

new Chart(document.getElementById('trafficChart'), {
  type: 'line',
  data: {
    labels: trafficLabels,
    datasets: [{
      label: 'Xe v√†o',
      data: trafficIn,
      tension: 0.35,
      fill: false,
    },{
      label: 'Xe ra',
      data: trafficOut,
      tension: 0.35,
      fill: false,
    }]
  },
  options: {
    responsive: true,
    plugins: { legend: { display: true } },
    scales: {
      y: { beginAtZero: true }
    }
  }
});
</script>
{% endblock %}
